(function(e,t){if(typeof define==="function"&&define.amd){define(["./Decoder","./YUVCanvas"],t)}else if(typeof exports==="object"){module.exports=t(require("./Decoder"),require("./YUVCanvas"))}else{e.Player=t(e.Decoder,e.YUVCanvas)}})(this,function(e,t){"use strict";var a=e.nowValue;var i=function(t){var i=this;this._config=t||{};this.render=true;if(this._config.render===false){this.render=false}this.nowValue=a;this._config.workerFile=this._config.workerFile||"Decoder.js";if(this._config.preserveDrawingBuffer){this._config.contextOptions=this._config.contextOptions||{};this._config.contextOptions.preserveDrawingBuffer=true}var n="auto";if(this._config.webgl===true){n=true}else if(this._config.webgl===false){n=false}if(n=="auto"){n=true;try{if(!window.WebGLRenderingContext){n=false}else{var s=document.createElement("canvas");var r=s.getContext("webgl");if(!r){n=false}}}catch(e){n=false}}this.webgl=n;if(this.webgl){this.createCanvasObj=this.createCanvasWebGL;this.renderFrame=this.renderFrameWebGL}else{this.createCanvasObj=this.createCanvasRGB;this.renderFrame=this.renderFrameRGB}var o;var c;var h=function(e,t,n,s){i.onPictureDecoded(e,t,n,s);var r=a();if(!e||!i.render){return}i.renderFrame({canvasObj:i.canvasObj,data:e,width:t,height:n});if(i.onRenderFrameComplete){i.onRenderFrameComplete({data:e,width:t,height:n,infos:s,canvasObj:i.canvasObj})}};if(!this._config.size){this._config.size={}}this._config.size.width=this._config.size.width||200;this._config.size.height=this._config.size.height||200;if(this._config.useWorker){var f=new Worker(this._config.workerFile);this.worker=f;f.addEventListener("message",function(e){var t=e.data;if(t.consoleLog){console.log(t.consoleLog);return}h.call(i,new Uint8Array(t.buf,0,t.length),t.width,t.height,t.infos)},false);f.postMessage({type:"Broadway.js - Worker init",options:{rgb:!n,memsize:this.memsize,reuseMemory:this._config.reuseMemory?true:false}});if(this._config.transferMemory){this.decode=function(e,t){f.postMessage({buf:e.buffer,offset:e.byteOffset,length:e.length,info:t},[e.buffer])}}else{this.decode=function(e,t){var a=new Uint8Array(e.length);a.set(e,0,e.length);f.postMessage({buf:a.buffer,offset:0,length:e.length,info:t},[a.buffer])}}if(this._config.reuseMemory){this.recycleMemory=function(e){f.postMessage({reuse:e.buffer},[e.buffer])}}}else{this.decoder=new e({rgb:!n});this.decoder.onPictureDecoded=h;this.decode=function(e,t){i.decoder.decode(e,t)}}if(this.render){this.canvasObj=this.createCanvasObj({contextOptions:this._config.contextOptions});this.canvas=this.canvasObj.canvas}this.domNode=this.canvas;o=this._config.size.width;c=this._config.size.height};i.prototype={onPictureDecoded:function(e,t,a,i){},recycleMemory:function(e){},createCanvasWebGL:function(e){var t=this._createBasicCanvasObj(e);t.contextOptions=e.contextOptions;return t},createCanvasRGB:function(e){var t=this._createBasicCanvasObj(e);return t},_createBasicCanvasObj:function(e){e=e||{};var t={};var a=e.width;if(!a){a=this._config.size.width}var i=e.height;if(!i){i=this._config.size.height}t.canvas=document.createElement("canvas");t.canvas.width=a;t.canvas.height=i;t.canvas.style.backgroundColor="#0D0E1B";return t},renderFrameWebGL:function(e){var a=e.canvasObj;var i=e.width||a.canvas.width;var n=e.height||a.canvas.height;if(a.canvas.width!==i||a.canvas.height!==n||!a.webGLCanvas){a.canvas.width=i;a.canvas.height=n;a.webGLCanvas=new t({canvas:a.canvas,contextOptions:a.contextOptions,width:i,height:n})}var s=i*n;var r=i/2*(n/2);a.webGLCanvas.drawNextOutputPicture({yData:e.data.subarray(0,s),uData:e.data.subarray(s,s+r),vData:e.data.subarray(s+r,s+r+r)});var o=this;o.recycleMemory(e.data)},renderFrameRGB:function(e){var t=e.canvasObj;var a=e.width||t.canvas.width;var i=e.height||t.canvas.height;if(t.canvas.width!==a||t.canvas.height!==i){t.canvas.width=a;t.canvas.height=i}var n=t.ctx;var s=t.imgData;if(!n){t.ctx=t.canvas.getContext("2d");n=t.ctx;t.imgData=n.createImageData(a,i);s=t.imgData}s.data.set(e.data);n.putImageData(s,0,0);var r=this;r.recycleMemory(e.data)}};return i});